
[ENG-1472] Refactor SQLite migration system for better maintainability
Status: Spec Needed

Description:
The current SQLite migration system in `hld/store/sqlite.go` uses a simple but unstructured approach with all migration logic hardcoded inline. This needs refactoring to improve organization, testability, and long-term maintainability for our client-side database architecture.

## Key Details

* All migrations are embedded in a single `applyMigrations()` function with inline conditionals
* No rollback support or structured migration definitions
* Limited testing coverage for migration scenarios
* SQL statements are embedded as strings in Go code
* Each user has their own local SQLite database, requiring extremely robust migrations

## Implementation Notes

1. Extract migrations into structured definitions (Migration structs with Version, Description, Up/Down methods)
2. Add comprehensive migration testing from various starting schema versions
3. Consider using Go's embed feature for SQL files if migrations become more complex
4. Implement migration health checks to detect and report issues
5. Document migration conventions for future contributors

## References

* Source: `thoughts/shared/research/2025-06-26_15-27-17_sqlite_migrations_best_practices.md`
* Related code: `hld/store/sqlite.go:199-239` (current migration implementation)
* Example migration: `hld/store/sqlite.go:212-236` (Migration 3 adding permission fields)

Comments:
[2025-06-26] Dexter Horthy:
lgtm - fine to skip traige on this one - @sundeep can you confirm you saw this (for mental alignment)


View in Linear: https://linear.app/humanlayer/issue/ENG-1472/refactor-sqlite-migration-system-for-better-maintainability
