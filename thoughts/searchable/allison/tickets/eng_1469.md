
[ENG-1469] Research/Spec - How do we release the WUI app?
Status: spec in review
Assignee: Sundeep Malladi

Description:
### problem to solve

we need to give people the stuff in a way that they can just run it on their workstation

We need a 1-page readme on how to install the WUI - we can make it better over time, but it should work on a fresh workstation. e.g. "make it run on austin's laptop".

### basic details

we need a download url

we need cdn/hosting or just s3 for the app payload

we need eventually brew --cask install

let's build a spec that has a phased implementation, starting with the bare minimum to be able to distribute, could even just be an OSX dmg in google drive or something, note the later phases

need to do so some research on like signing etc. As long as first 5 users have root on their macbook they can override the security signing thing

need to think through all the CLIs/etc that the wui uses? running the daemon, etc etc - right now hld runs separately, app needs to launch the daemon and manage it's lifecycle (or embed it in the app process event)

---

## Updated Requirements Summary

### Requirements for Tauri v2 DMG Distribution

1. **Pre-built Binary Packaging**
   * Ship pre-compiled `hld` Go binary for Apple Silicown (aarch64-apple-darwin)
   * Ship pre-compiled `hlyr` CLI as a standalone binary (using pkg or similar to avoid Node.js dependency)
   * Bundle both binaries as Tauri sidecars within the .app
2. **Automatic Daemon Management**
   * Launch `hld` daemon automatically on WUI startup via Tauri's setup hook
   * Stop daemon cleanly when WUI closes
   * No manual daemon setup required by end users
3. **DMG Creation**
   * Build unsigned .app bundle with all dependencies included
   * Package as DMG for drag-and-drop installation
   * Include basic instructions for Gatekeeper override (since unsigned)
4. **Zero External Dependencies for End Users**
   * No Xcode/CLT required
   * No Rust toolchain required
   * No Node.js required
   * No Go required
   * Everything runs from the self-contained .app bundle
5. **Connection Handling**
   * WUI waits for daemon to be ready before attempting connection
   * Transparent to user - they just launch the app
6. **Build Process (Developer Side)**
   * Compile `hld` for macOS/arm64
   * Package `hlyr` as standalone binary
   * Configure Tauri to include these as sidecars
   * Generate DMG with proper layout
7. **Minimal Scope**
   * Focus only on Apple Silicon macOS support for MVP
   * Skip code signing/notarization
   * Skip auto-updates
   * Skip Intel Mac support (unless trivial to add)

### Implementation Research

Detailed implementation research has been documented here:
[https://github.com/humanlayer/thoughts/blob/main/repos/humanlayer/shared/research/2025-07-02_10-14-16_tauri_dmg_packaging_implementation.md](https://github.com/humanlayer/thoughts/blob/main/repos/humanlayer/shared/research/2025-07-02_10-14-16_tauri_dmg_packaging_implementation.md)

The research outlines 5 implementation phases with technical options for the engineer to consider.

Comments:
[2025-07-02] Sundeep Malladi:
Couple notes:

* Agree on moving away from CGO when possible, but should delay that until we're distributing to more platforms/know how long Go is sticking around.
* I think `pkg` is off the table as the binary packaging tool for the CLI as [Vercel has archived the repo](https://github.com/vercel/pkg) (I've used it in the past too and had similarly good experience). `nexe` is new to me and single executable stuff that node has baked in might be an option. `nexe` might be the better option, as I suspect there are going to be some things related to import/export of stuff and seems like it's got a pretty solid GH star count. 
* Exclusive vs shared daemon - Good call, yes we'd need to figure out what to do with the DB and agree getting it to the appropriate application-specific location is probably best
*  Agreed, hold on GHA.
* This "**Current state**: WUI expects daemon at `~/.humanlayer/daemon.sock` **Future state**: WUI manages daemon lifecycle transparently" is crazy and I'm taking it out. The important thing from this section is revealing the health of the hld in the wui. I wonder whether we should be stopping the daemon on shutdown, I get starting it though (depends on whether the TUI is in play, or perhaps alternate clients? not sure)
* We should not do intel mac support as part of this ticket, let's stick to getting Apple Silicon going and then start expanding from there
* Important note re: config paths, Tauri appears to have a natural way to resolve this via a `dataDir()` method: [https://v2.tauri.app/reference/javascript/api/namespacepath/#datadi](https://v2.tauri.app/reference/javascript/api/namespacepath/#datadir)r
  * There appear to be similar things on the Rust side: [https://docs.rs/tauri/2.6.2/tauri/path/struct.PathResolver.html#method.app_data_dir](https://docs.rs/tauri/2.6.2/tauri/path/struct.PathResolver.html#method.app_data_dir)
* Should we support only triggering the hld daemon if we don't detect one running locally before the app starts?

[2025-07-02] Dexter Horthy:
thoughts:

1. re: sqlite - i would vote to avoid CGO if possible, makes cross-plat stuff way easier. But i have not actually seen/used the pure go sqlite driver, not sure if it sucks
2. i used pkg a long time ago. it def worksâ€¦also kind of hacky though. Have you looked at all into what other similar tools are using (none off the top of my head rn)
3. `Exclusive vs shared daemon (new instance per app vs connect to existing)` - its not just the daemon, its the db too, right?
4. what path does our stuff go in? Library/Application\\ Support/â€¦. ? or do we want to proceed with current \~/.humanlayer/ ? Is there a `XDG_CONFIG_HOME` equiv for things that would go in `/var/run`  on a standalone server?
5. re: **Current state**: WUI expects daemon at `~/.humanlayer/daemon.sock` **Future state**: WUI manages daemon lifecycle transparently - what do you mean by transparently? you mean like "hidden from the user" - how can a user explore/debug? 
6. I think phase 5 w/ the github actions can be out of scope for the MVP here - as long as someone can build it on their workstation (maybe bus factor 2-3 on that?)
7. \`Future cloud daemon mode would eliminate local daemon need\` i'm not sure if this is true - @allison  and I chatted about this on Fridayâ€¦might still need a local daemon to stream the stdout from the process, even if it just forwards all events to the cloud. Or we could launch a standalone wrapper process for each claude code that streams things up to a cloud daemon. In either case not super relevant to the correctness of this spec, just wanna note it

I think we need answers to the open questions before we can proceed?

1. Binary packaging tool selection (pkg vs SEA vs nexe)
2. Shared vs exclusive daemon instances
3. Intel Mac support priority (NOT IMPORTANT)
4. Configuration file handling in bundled mode (XDG vs. Application Support??)
5. Migration path for existing users with manual daemon setup (NOT IMPORTANT)

[2025-07-02] Dexter Horthy:
@sundeep first link in research doc in github has a broken link - shoudl it be [https://v2.tauri.app/develop/sidecar/#\_top](https://v2.tauri.app/develop/sidecar/#\_top)

![Screenshot 2025-07-02 at 11.06.18â€¯AM.png](https://uploads.linear.app/3ee2840f-7196-42ab-91f2-73ab50c48671/4aaeb3c1-cb39-4c34-ab65-c09c8ace53e6/4292e821-b624-49c3-8e03-d8d064ca2717)

[2025-07-02] Sundeep Malladi:
bah, sorry, updated now

[2025-07-02] Dexter Horthy:
@sundeep tauri v2 dmg link is broken for me (the one in the comment) - the one in issue body working now thanks

[2025-07-02] Sundeep Malladi:
Yep, both links now updated and local thoughts now pushed up

[2025-07-02] allison@humanlayer.dev:
Move to spec in review if actually done (your research is a full plan, otherwise yeah create plaln) (and your link is dead - Both links to wrong place and I think you need to git pull rebase and push)

[2025-07-02] Sundeep Malladi:
## Implementation Research Complete

I've completed the detailed implementation research for the Tauri v2 DMG packaging. The research document is available here:

ðŸ“„ [**Tauri v2 DMG Packaging Implementation Research**](https://github.com/humanlayer/thoughts/blob/main/repos/humanlayer/shared/research/2025-07-02_10-14-16_tauri_dmg_packaging_implementation.md)

The research outlines 5 implementation phases:

1. Binary Preparation
2. Tauri Sidecar Configuration
3. Daemon Lifecycle Management
4. Build Automation
5. Distribution Pipeline

Each phase includes technical options and considerations for the implementing engineer.

[2025-07-02] Dexter Horthy:
@sundeep overall plan LGTM 

[2025-07-02] Dexter Horthy:
for (2) - what happens to running sessions when the daemon stops? do they get interrupted? (we had talked a little bit about a "resume on startup" type thing too)

[2025-07-02] Dexter Horthy:
[https://v2.tauri.app/develop/plugins/#setup](https://v2.tauri.app/develop/plugins/#setup)

[2025-07-02] Dexter Horthy:
feedack - this post would be better with links, e.g. I had to go look up [https://v2.tauri.app/develop/sidecar/](https://v2.tauri.app/develop/sidecar/)

[2025-07-02] Sundeep Malladi:
Note, above is not the actual research task work, just relaying out requirements for this ticket on initial pass

[2025-07-02] Sundeep Malladi:
## Updated Requirements for Tauri v2 DMG Distribution

### 1. **Pre-built Binary Packaging**
- Ship pre-compiled `hld` Go binary for Apple Silicon (aarch64-apple-darwin)
- Ship pre-compiled `hlyr` CLI as a standalone binary (using pkg or similar to avoid Node.js dependency)
- Bundle both binaries as Tauri sidecars within the .app

### 2. **Automatic Daemon Management**
- Launch `hld` daemon automatically on WUI startup via Tauri's setup hook
- Stop daemon cleanly when WUI closes
- No manual daemon setup required by end users

### 3. **DMG Creation**
- Build unsigned .app bundle with all dependencies included
- Package as DMG for drag-and-drop installation
- Include basic instructions for Gatekeeper override (since unsigned)

### 4. **Zero External Dependencies for End Users**
- No Xcode/CLT required
- No Rust toolchain required  
- No Node.js required
- No Go required
- Everything runs from the self-contained .app bundle

### 5. **Connection Handling**
- WUI waits for daemon to be ready before attempting connection
- Transparent to user - they just launch the app

### 6. **Build Process (Developer Side)**
- Compile `hld` for macOS/arm64
- Package `hlyr` as standalone binary
- Configure Tauri to include these as sidecars
- Generate DMG with proper layout

### 7. **Minimal Scope**
- Focus only on Apple Silicon macOS support for MVP
- Skip code signing/notarization 
- Skip auto-updates
- Skip Intel Mac support (unless trivial to add)

[2025-07-01] allison@humanlayer.dev:
I guess technically it's `humanlayer` now and not hlyr. And yeah maybe it makes sense to package the whole thing as well.

[2025-07-01] Sundeep Malladi:
I'm wondering if we package `hlyr` in as well. Node.js 21+ introduced "single executable applications" which might be one approach: [https://nodejs.org/api/single-executable-applications.html](https://nodejs.org/api/single-executable-applications.html)

[2025-07-01] allison@humanlayer.dev:
Things needed alongside install:

* Daemon (built and running on wui launch - perhaps similar to how hlyr does currently?)
* WUI

Things needed beside install:

* claude cli
* macos or linux (for pathing to work)

Things not needed:

* hlyr (is launched via npx)


View in Linear: https://linear.app/humanlayer/issue/ENG-1469/researchspec-how-do-we-release-the-wui-app
