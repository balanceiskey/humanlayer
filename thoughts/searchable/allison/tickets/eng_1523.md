
[ENG-1523] Create JSON-RPC endpoint to retrieve file snapshots for frontend
Status: ready for dev
Assignee: allison@humanlayer.dev

Description:
Frontend needs access to file snapshots captured during Read operations. Create a simple API endpoint that returns all snapshots for a session.

## Key Details

* Single `GetSessionSnapshots` endpoint returns all snapshots for a session
* Response includes: toolId, filePath, content, fileHash, timestamp
* Include Read metadata (numLines, startLine, totalLines) from original Read
* Order by timestamp (most recent first)
* Keep API simple - frontend can filter/cache as needed

## Implementation Notes

Add new handler in `hld/rpc/handlers.go` following pattern of existing endpoints like `GetConversation` at `hld/rpc/handlers.go:185-238`.

## References

* Source: `thoughts/shared/research/2025-07-03_09-43-22_wui_diff_view_tickets.md` ([View on GitHub](https://github.com/humanlayer/thoughts/blob/main/repos/humanlayer/shared/research/2025-07-03_09-43-22_wui_diff_view_tickets.md))
* Related code: `hld/rpc/handlers.go:185-238`
* Parent ticket: [ENG-1502](https://linear.app/humanlayer/issue/ENG-1502/make-tickets-to-improve-diff-views)

Comments:
[2025-07-07 11:47:51] allison@humanlayer.dev:
Created a comprehensive implementation plan for the file snapshot RPC endpoint.

## What was done:
- Analyzed existing RPC patterns and handler structure in `hld/rpc`
- Verified the store interface changes from ENG-1520
- Created detailed implementation plan with 3 phases:
  1. Define RPC types following existing patterns
  2. Implement handler in SessionHandlers with proper error handling
  3. Add integration tests

## Key decisions:
- Endpoint returns all snapshots for a session (no pagination in MVP)
- Timestamps formatted as ISO 8601 strings (consistent with existing endpoints)
- Proper session validation and error handling
- Frontend handles filtering and caching

## Implementation plan:
`thoughts/shared/plans/file_snapshot_rpc.md`

The plan is ready for review and implementation.

[2025-07-08 08:27:35] Dexter Horthy:
questions

> matching snapshots to Edit operations.

i don't see this elaborated on / exemplified - how will that work? is that in another plan?

> 1. Launch Claude Code session: `hlyr claude-code`

looks wrong - worth fixing?

is this real: ???

> 1. 
>
>    ```
>    hlyr rpc getSessionSnapshots '{"session_id": "SESSION_ID_HERE"}'
>    ```

[2025-07-08 08:30:44] Dexter Horthy:
aside - its cool that this plan is aware of [ENG-1520](https://linear.app/humanlayer/issue/ENG-1520/implement-file-snapshot-system-to-capture-full-content-during-read) as a dependency and notes it needs to be done first


View in Linear: https://linear.app/humanlayer/issue/ENG-1523/create-json-rpc-endpoint-to-retrieve-file-snapshots-for-frontend
