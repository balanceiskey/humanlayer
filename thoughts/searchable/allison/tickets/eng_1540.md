
[ENG-1540] Should we use the model returned from Claude init
Status: Spec Needed
Assignee: allison@humanlayer.dev

Description:
## Problem to solve

if launched with no model, uses default, be we don't store any on the session state, and so it shows the big Ã¸ null value instead of what model claude picked from settings. We can read the model from the init message and use it to populate the session table in db.

## Context

During research for [ENG-1536](https://linear.app/humanlayer/issue/ENG-1536/model-selector-in-launch-modal-doesnt-work-models-are-oldfake), discovered that the daemon doesn't capture the actual model used by Claude from the init event.

## Current State

* The daemon only processes `subtype="session_created"` events
* It ignores `subtype="init"` events which contain the actual model field
* The database stores only the requested model, not what Claude actually uses

## Technical Details

The StreamEvent struct in `claudecode-go/types.go:75` has a Model field populated in system events with `subtype="init"`, but the daemon's event processor (`session/manager.go:525-555`) doesn't handle these events.

## Implementation Considerations

If we decide to implement this:

1. Add handler for init events in `processStreamEvent`
2. Add Model field to SessionUpdate struct in `store/store.go:82-93`
3. Update the session's model after Claude reports actual selection

## Questions to Answer

* Do we want to track what model Claude actually used vs what was requested?
* Should we display both requested and actual models in the UI?
* Is this information valuable for debugging or user awareness?

Related to: [ENG-1536](https://linear.app/humanlayer/issue/ENG-1536/model-selector-in-launch-modal-doesnt-work-models-are-oldfake)

Comments:
[2025-07-08 09:15:41] allison@humanlayer.dev:
One thing to note: The init command returns the API version `"model":"claude-opus-4-20250514"` and we use "opus" and "sonnet" for display and parameters. I think probably "if match opus" or "if match sonnet" we set to the same words we use for the parameters.


View in Linear: https://linear.app/humanlayer/issue/ENG-1540/should-we-use-the-model-returned-from-claude-init
